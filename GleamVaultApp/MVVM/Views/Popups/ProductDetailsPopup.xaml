<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup
    x:Class="GleamVault.MVVM.Views.Popups.ProductDetailsPopup"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:conv="clr-namespace:GleamVault.Converters"
    xmlns:models="clr-namespace:Shared.Models;assembly=Shared"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Padding="0"
    x:DataType="models:Product"
    Background="{StaticResource Brush.CardBgGradient}"
    CanBeDismissedByTappingOutsideOfPopup="True"
    MaximumHeightRequest="800"
    WidthRequest="550">
    <toolkit:Popup.Resources>
        <conv:PriceConverter x:Key="PriceConverter" />
        <conv:HallmarkTypeConverter x:Key="HallmarkTypeConverter" />
        <conv:WeightUnitConverter x:Key="WeightUnitConverter" />
        <conv:IsNotNullOrEmptyConverter x:Key="IsNotNullOrEmptyConverter" />
        <conv:IsGreaterThanZeroConverter x:Key="IsGreaterThanZeroConverter" />
        <conv:DiscountPriceColorConverter x:Key="DiscountPriceColorConverter" />
        <conv:DiscountTextDecorationsConverter x:Key="DiscountTextDecorationsConverter" />
    </toolkit:Popup.Resources>

    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="0">
        <!--  Header with Product Image  -->
        <Border
            Grid.Row="0"
            Padding="20,16"
            Background="{StaticResource Brush.HeaderGradient}"
            StrokeShape="RoundRectangle 10"
            StrokeThickness="0">
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
                <Border
                    Grid.Column="0"
                    HeightRequest="48"
                    StyleClass="icon-circle"
                    WidthRequest="48">
                    <Image
                        HeightRequest="28"
                        Source="diamond.png"
                        WidthRequest="28" />
                </Border>
                <VerticalStackLayout
                    Grid.Column="1"
                    Spacing="4"
                    VerticalOptions="Center">
                    <Label StyleClass="h3" Text="Product Details" />
                    <Label
                        FontSize="12"
                        Text="{Binding Name}"
                        TextColor="{StaticResource TextLight}" />
                </VerticalStackLayout>
            </Grid>
        </Border>

        <!--  Product Details Content  -->
        <ScrollView Grid.Row="1" Padding="0,20,0,20">
            <VerticalStackLayout Spacing="16">
                <!--  Product Image Card  -->
                <Border
                    Background="White"
                    HeightRequest="170"
                    Shadow="{StaticResource Sh.CyanSm}"
                    StrokeShape="RoundRectangle 16"
                    StrokeThickness="0">
                    <Grid Padding="10">
                        <Image
                            Aspect="AspectFit"
                            BackgroundColor="Transparent"
                            Source="{Binding ImageUrl}" />
                    </Grid>
                </Border>

                <!--  Basic Information Card  -->
                <Border
                    Padding="16"
                    Background="White"
                    Shadow="{StaticResource Sh.CyanSm}"
                    StrokeShape="RoundRectangle 16"
                    StrokeThickness="0">
                    <VerticalStackLayout Spacing="12">
                        <Label StyleClass="h4" Text="Basic Information" />
                        <BoxView
                            BackgroundColor="{StaticResource Border}"
                            HeightRequest="1"
                            HorizontalOptions="Fill" />
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                            <!--  SKU  -->
                            <Grid
                                Grid.Row="0"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="SKU" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaHeavy"
                                    FontSize="14"
                                    Text="{Binding Sku}"
                                    TextColor="{StaticResource TextDark}" />
                            </Grid>
                            <!--  Name  -->
                            <Grid
                                Grid.Row="1"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Name" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaHeavy"
                                    FontSize="14"
                                    Text="{Binding Name}"
                                    TextColor="{StaticResource TextDark}" />
                            </Grid>
                            <!--  Description  -->
                            <Grid
                                Grid.Row="2"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12"
                                IsVisible="{Binding Description, Converter={StaticResource IsNotNullOrEmptyConverter}}">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Description"
                                    VerticalOptions="Start" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaLight"
                                    FontSize="14"
                                    LineBreakMode="WordWrap"
                                    Text="{Binding Description}"
                                    TextColor="{StaticResource TextDark}"
                                    VerticalOptions="Start" />
                            </Grid>
                            <!--  Category  -->
                            <Grid
                                Grid.Row="3"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Category" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaHeavy"
                                    FontSize="14"
                                    Text="{Binding Category.Name}"
                                    TextColor="{StaticResource TextDark}" />
                            </Grid>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!--  Pricing Card  -->
                <Border
                    Padding="16"
                    Background="White"
                    Shadow="{StaticResource Sh.CyanSm}"
                    StrokeShape="RoundRectangle 16"
                    StrokeThickness="0">
                    <VerticalStackLayout Spacing="12">
                        <Label StyleClass="h4" Text="Pricing" />
                        <BoxView
                            BackgroundColor="{StaticResource Border}"
                            HeightRequest="1"
                            HorizontalOptions="Fill" />
                        <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
                            <!--  Unit Cost  -->
                            <Grid
                                Grid.Row="0"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Unit Cost" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaHeavy"
                                    FontSize="14"
                                    Text="{Binding UnitCost, StringFormat='${0:F2}'}"
                                    TextColor="{StaticResource TextDark}" />
                            </Grid>
                            <!--  Unit Price  -->
                            <Grid
                                Grid.Row="1"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Unit Price" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaHeavy"
                                    FontSize="18"
                                    TextColor="{Binding OfferPrice, Converter={StaticResource DiscountPriceColorConverter}, FallbackValue={StaticResource Primary}}"
                                    VerticalOptions="Center">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding UnitPrice, Converter={StaticResource PriceConverter}}" TextDecorations="{Binding OfferPrice, Converter={StaticResource DiscountTextDecorationsConverter}}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </Grid>
                            <!--  Offer Price  -->
                            <Grid
                                Grid.Row="2"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12"
                                IsVisible="{Binding OfferPrice, Converter={StaticResource IsGreaterThanZeroConverter}}">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Offer Price" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaHeavy"
                                    FontSize="18"
                                    Text="{Binding OfferPrice, Converter={StaticResource PriceConverter}}"
                                    TextColor="{StaticResource Primary}"
                                    VerticalOptions="Center" />
                            </Grid>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!--  Inventory Card  -->
                <Border
                    Padding="16"
                    Background="White"
                    Shadow="{StaticResource Sh.CyanSm}"
                    StrokeShape="RoundRectangle 16"
                    StrokeThickness="0">
                    <VerticalStackLayout Spacing="12">
                        <Label StyleClass="h4" Text="Inventory" />
                        <BoxView
                            BackgroundColor="{StaticResource Border}"
                            HeightRequest="1"
                            HorizontalOptions="Fill" />
                        <Grid ColumnDefinitions="100,*" ColumnSpacing="12">
                            <Label
                                Grid.Column="0"
                                StyleClass="caption"
                                Text="Stock" />
                            <Border
                                Grid.Column="1"
                                Padding="8,6"
                                Background="{StaticResource Secondary}"
                                HorizontalOptions="Start"
                                StrokeShape="RoundRectangle 8"
                                StrokeThickness="0">
                                <Label
                                    FontFamily="NexaHeavy"
                                    FontSize="14"
                                    Text="{Binding CurrentStock}"
                                    TextColor="{StaticResource TextDark}" />
                            </Border>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!--  Specifications Card  -->
                <Border
                    Padding="16"
                    Background="White"
                    Shadow="{StaticResource Sh.CyanSm}"
                    StrokeShape="RoundRectangle 16"
                    StrokeThickness="0">
                    <VerticalStackLayout Spacing="12">
                        <Label StyleClass="h4" Text="Specifications" />
                        <BoxView
                            BackgroundColor="{StaticResource Border}"
                            HeightRequest="1"
                            HorizontalOptions="Fill" />
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                            <!--  Hallmark  -->
                            <Grid
                                Grid.Row="0"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Hallmark" />
                                <Label
                                    Grid.Column="1"
                                    FontFamily="NexaHeavy"
                                    FontSize="14"
                                    Text="{Binding Hallmark, Converter={StaticResource HallmarkTypeConverter}}"
                                    TextColor="{StaticResource TextDark}" />
                            </Grid>
                            <!--  Weight  -->
                            <Grid
                                Grid.Row="1"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Weight" />
                                <HorizontalStackLayout Grid.Column="1" Spacing="5">
                                    <Label
                                        FontFamily="NexaHeavy"
                                        FontSize="14"
                                        Text="{Binding Weight, StringFormat='{0:F2}'}"
                                        TextColor="{StaticResource TextDark}"
                                        VerticalOptions="Center" />
                                    <Label
                                        FontFamily="NexaLight"
                                        FontSize="14"
                                        Text="{Binding WeightUnit, Converter={StaticResource WeightUnitConverter}}"
                                        TextColor="{StaticResource TextLight}"
                                        VerticalOptions="Center" />
                                </HorizontalStackLayout>
                            </Grid>
                            <!--  Is Unique Piece  -->
                            <Grid
                                Grid.Row="2"
                                ColumnDefinitions="100,*"
                                ColumnSpacing="12">
                                <Label
                                    Grid.Column="0"
                                    StyleClass="caption"
                                    Text="Unique Piece" />
                                <Border
                                    Grid.Column="1"
                                    Padding="8,6"
                                    Background="{StaticResource Secondary}"
                                    HorizontalOptions="Start"
                                    StrokeShape="RoundRectangle 8"
                                    StrokeThickness="0">
                                    <Label
                                        FontFamily="NexaHeavy"
                                        FontSize="14"
                                        Text="{Binding IsUniquePiece, StringFormat='{0}'}"
                                        TextColor="{StaticResource TextDark}" />
                                </Border>
                            </Grid>
                        </Grid>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!--  Actions  -->
        <Border
            Grid.Row="2"
            Padding="20,16"
            Background="White"
            StrokeShape="RoundRectangle 10"
            StrokeThickness="0">
            <Button
                Background="{StaticResource Brush.ButtonGradient}"
                Clicked="Button_Clicked"
                CornerRadius="12"
                FontFamily="NexaHeavy"
                FontSize="16"
                HeightRequest="48"
                HorizontalOptions="Fill"
                Text="Close"
                TextColor="White" />
        </Border>
    </Grid>
</toolkit:Popup>

